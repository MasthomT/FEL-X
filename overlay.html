<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Overlay Shoutout</title>
    <style>
        body { margin: 0; overflow: hidden; background: transparent; }
        #player {
            position: absolute; top: 20px; right: 20px;
            width: 480px; height: 272px;
            display: none;
            /* Fond transparent pour éviter le carré noir */
            background: transparent; 
        }
        iframe { width: 100%; height: 100%; border: none; }
    </style>
</head>
<body>
    <div id="player">
        <iframe id="clip-frame" src="" allow="autoplay; fullscreen"></iframe>
    </div>

    <script>
        // ADRESSE LOCALE DU PI
        const PI_API_URL = "http://192.168.1.109:8080/api/overlay_status";

        let currentUrl = "";

        setInterval(() => {
            fetch(PI_API_URL)
                .then(r => r.json())
                .then(data => {
                    const div = document.getElementById('player');
                    const frame = document.getElementById('clip-frame');

                    if (data.active && data.url) {
                        if (currentUrl !== data.url) {
                            console.log("Nouveau clip :", data.url);
                            frame.src = data.url;
                            currentUrl = data.url;
                            div.style.display = 'block';
                        }
                    } else {
                        if (div.style.display !== 'none') {
                            div.style.display = 'none';
                            frame.src = "";
                            currentUrl = "";
                        }
                    }
                })
                .catch(err => {
                    // Erreur silencieuse en attendant la connexion
                });
        }, 1000);
    </script>
</body>
</html>