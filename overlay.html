<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Lecteur Plein Écran</title>
    <style>
        /* On supprime toutes les marges et on force le plein écran */
        body, html { 
            margin: 0; 
            padding: 0; 
            width: 100%; 
            height: 100%; 
            overflow: hidden; 
            background: transparent; 
        }

        #player {
            /* Positionnement absolu en haut à gauche */
            position: absolute;
            top: 0;
            left: 0;
            /* Taille maximale */
            width: 100%; 
            height: 100%;
            display: none;
            /* Pas de bordure, pas de fond noir pour un rendu propre */
        }

        iframe { 
            width: 100%; 
            height: 100%; 
            border: none; 
        }
    </style>
</head>
<body>
    <div id="player">
        <iframe id="clip-frame" src="" allow="autoplay; fullscreen"></iframe>
    </div>

    <script>
        // --- IP DE TON RASPBERRY PI ---
        const PI_URL = "http://192.168.1.109:8080/api/overlay_status";
        // ------------------------------

        let currentId = "";

        setInterval(() => {
            fetch(PI_URL)
                .then(r => r.json())
                .then(data => {
                    const div = document.getElementById('player');
                    const frame = document.getElementById('clip-frame');

                    if (data.active && data.url) {
                        // Si on a un nouvel ID
                        if (currentId !== data.url) {
                            console.log("Nouveau Clip:", data.url);
                            currentId = data.url;
                            
                            // On force l'autoplay et le parent localhost
                            frame.src = `https://clips.twitch.tv/embed?clip=${currentId}&parent=localhost&autoplay=true&muted=false`;
                            
                            div.style.display = 'block';
                        }
                    } else {
                        if (div.style.display !== 'none') {
                            div.style.display = 'none';
                            frame.src = "";
                            currentId = "";
                        }
                    }
                })
                .catch(e => console.log("Attente du Pi..."));
        }, 1000);
    </script>
</body>
</html>