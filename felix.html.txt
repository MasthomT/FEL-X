<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>F√©lix et moi | FEL-X</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="sidebar">
        </nav>

    <main class="content">
        <header class="section-header">
            <h1>F√©lix et moi</h1>
            <p class="subtitle">Apprends √† F√©lix qui tu es pour qu'il te reconnaisse en stream.</p>
        </header>

        <form id="felix-form" class="card form-card">
            <div class="form-grid">
                <div class="form-group">
                    <label>Ton petit surnom</label>
                    <input type="text" id="v_nickname" placeholder="Comment F√©lix doit t'appeler ?">
                </div>
                <div class="form-group">
                    <label>Date d'anniversaire</label>
                    <input type="date" id="v_birthday">
                </div>
                <div class="form-group">
                    <label>Pronoms</label>
                    <select id="v_pronouns">
                        <option value="il">Il</option>
                        <option value="elle">Elle</option>
                        <option value="iel">Iel / Autre</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ta Vibe au quotidien</label>
                    <input type="text" id="v_vibe" placeholder="Plut√¥t calme, √©nerv√©, dr√¥le ?">
                </div>
            </div>

            <div class="form-group full-width">
                <label>Un message pour F√©lix ? (Ce qu'il doit absolument savoir sur toi)</label>
                <textarea id="v_free_message" rows="4"></textarea>
            </div>

            <button type="submit" class="btn-save">M√©moriser mes infos</button>
            <p id="status-msg" class="status-hidden">F√©lix a bien enregistr√© tes infos ! üê±</p>
        </form>
    </main>

    <script src="config.js"></script>
    <script src="app.js"></script>
    <script>
        document.getElementById("felix-form").onsubmit = async (e) => {
            e.preventDefault();
            const token = checkAuth();
            const user = await fetch('https://api.twitch.tv/helix/users', {
                headers: { 'Authorization': `Bearer ${token}`, 'Client-Id': CONFIG.CLIENT_ID }
            }).then(r => r.json());
            
            const userId = user.data[0].id;
            const payload = {
                nickname: document.getElementById("v_nickname").value,
                birthday: document.getElementById("v_birthday").value,
                pronouns: document.getElementById("v_pronouns").value,
                vibe: document.getElementById("v_vibe").value,
                message: document.getElementById("v_free_message").value
            };

            const resp = await fetch(`${CONFIG.SERVER_URL}/api/update_context`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'ngrok-skip-browser-warning': 'true' },
                body: JSON.stringify({ userId, ...payload })
            });

            if(resp.ok) {
                const msg = document.getElementById("status-msg");
                msg.className = "status-visible";
                setTimeout(() => msg.className = "status-hidden", 3000);
            }
        };
    </script>
</body>
</html>