<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FEL-X : Portail Viewer</title>
    <style>
        body { 
            background: #18181b; 
            color: white; 
            font-family: sans-serif; 
            margin: 0;
            padding: 2rem;
            display: grid;
            place-items: center;
            min-height: 90vh;
        }
        main {
            max-width: 900px;
            width: 100%;
            text-align: center;
        }
        
        #logo-container {
            margin-bottom: 2rem;
            background-image: url('/logo.png'); */
            background-size: contain; */
            background-repeat: no-repeat; */
            background-position: center; */
            min-height: 150px; */
        }
        #logo-container h1 {
            font-size: 4rem;
            color: #9146ff;
            margin: 0;
        }
        #logo-image {
            width: 120px;     
            height: 120px;     
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #9146ff;
            margin: 1rem auto;
            display: block;    
        }
        #welcome-message {
            font-size: 1.5rem;
            color: #e0e0e0;
        }
        
        #logged-out-view, #logged-in-view {
            margin-top: 3rem;
        }
        
        .btn-login { 
            background: #9146ff; 
            color: white; 
            padding: 1rem 2rem; 
            border-radius: 8px; 
            text-decoration: none; 
            font-weight: bold;
            font-size: 1.2rem;
            transition: background 0.2s ease;
            display: inline-block;
        }
        .btn-login:hover { background: #7a3be0; }

        .nav-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        .nav-card {
            display: block;
            background: #2a2a2d;
            border: 2px solid #36363a;
            border-radius: 8px;
            padding: 2rem;
            text-decoration: none;
            color: white;
            transition: transform 0.2s ease, background 0.2s ease;
        }
        .nav-card:hover {
            transform: translateY(-5px);
            background: #36363a;
        }
        .nav-card h2 {
            margin: 0 0 0.5rem 0;
            color: #9146ff;
        }
        .nav-card p {
            margin: 0;
            color: #c0c0c0;
            line-height: 1.4;
        }
        
        #logout { 
            color: #f44336; 
            cursor: pointer; 
            text-decoration: underline;
            display: inline-block;
            margin-top: 3rem;
            font-size: 1.1rem;
        }
        body {
        display: flex;
        height: 100vh;
        overflow: hidden;
        }
        main {
        flex-grow: 1; 
        overflow-y: auto;
        height: 100vh;
        }

        .sidebar {
        width: 250px;
        background-color: #2c2f33;
        flex-shrink: 0; 
        height: 100vh;
        display: flex;
        flex-direction: column;
        padding: 1rem 0;
        border-right: 1px solid #36363a;
        }
        .sidebar-header {
        padding: 0 1.5rem 1rem 1.5rem;
        border-bottom: 1px solid #36363a;
        }
        .sidebar-header .logo-link {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        text-decoration: none;
        color: white;
        }
.sidebar-header .logo-link img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
}
.sidebar-header .logo-link span {
    font-size: 1.5rem;
    font-weight: bold;
    color: #9146ff;
}

.sidebar a.nav-link {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 1.5rem;
    color: #b9bbbe;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.2s ease;
    border-left: 4px solid transparent;
}
.sidebar a.nav-link:hover {
    background: #36393f;
    color: white;
    border-left-color: #9146ff;
}
.sidebar a.nav-link svg {
    width: 22px;
    height: 22px;
    fill: currentColor;
    flex-shrink: 0;
}

.sidebar-footer {
    margin-top: auto; 
    padding-top: 1rem;
    border-top: 1px solid #36363a;
}
#logout-sidebar {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 1.5rem;
    color: #f44336; 
    text-decoration: none;
    font-weight: 600;
    transition: background 0.2s ease;
}
#logout-sidebar:hover {
    background: #36393f;
}
#logout-sidebar svg {
    width: 22px;
    height: 22px;
    fill: currentColor;
    flex-shrink: 0;
}
    </style>
</head>
<body>
    <nav class="sidebar">
        <div class="sidebar-header">
            <a href="/index.html" class="logo-link">
                <img src="/logo-felix.png" alt="Logo FEL-X">
                <span>FEL-X</span>
            </a>
        </div>
        
        <a href="/profile.html" class="nav-link" id="nav-profile">
            <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"></path></svg>
            <span>Mon Profil</span>
        </a>
        
        <a href="/info.html" class="nav-link" id="nav-info">
            <svg viewBox="0 0 24 24"><path d="M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"></path></svg>
            <span>Infos & Commandes</span>
        </a>
        
        <a href="/don.html" class="nav-link" id="nav-don">
            <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1.26 14.24c-.18.18-.44.29-.71.29s-.53-.11-.71-.29l-2.29-2.29c-.39-.39-.39-1.02 0-1.41.39-.39 1.02-.39 1.41 0l1.59 1.59 5.59-5.59c.39-.39 1.02-.39 1.41 0 .39.39.39 1.02 0 1.41l-6.29 6.29z"></path></svg>
            <span>Faire un Don</span>
        </a>

        <div class="sidebar-footer">
            <a id="logout-sidebar" href="#">
                <svg viewBox="0 0 24 24"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"></path></svg>
                <span>Se déconnecter</span>
            </a>
        </div>
    </nav>
    <main>
        <div id="logo-container">
            <img src="/logo-felix.png" alt="Logo FEL-X" id="logo-image">
            <p id="welcome-message">Votre portail communautaire</p>
        </div>

        <div id="logged-out-view" style="display:none;">
            <p>Connectez-vous avec Twitch pour accéder à votre profil, votre XP et plus encore.</p>
            <a id="login-link" class="btn-login" href="#">Se connecter avec Twitch</a>
        </div>

        <div id="logged-in-view" style="display:none;">
            <div class="nav-grid">
                <a href="/profile.html" class="nav-card">
                    <h2>Mon Profil</h2>
                    <p>Voir mon niveau, mon XP, mon historique et mon statut de follow.</p>
                </a>
                
                <a href="/info.html" class="nav-card">
                    <h2>Infos & Commandes</h2>
                    <p>Retrouver le planning, le lien Discord, YouTube et les règles du chat.</p>
                </a>
                
                <a href="/don.html" class="nav-card">
                    <h2>Faire un Don</h2>
                    <p>Soutenir la chaîne via PayPal, Streamlabs ou d'autres plateformes.</p>
                </a>
            </div>
            
            <a id="logout" href="#">Se déconnecter</a>
        </div>
    </main>
    
    <script>
        const CLIENT_ID = "8jpfq5497uee7kdrsx4djhb7nw2xec";
        const REDIRECT_URI = "https://fel-x.vercel.app/auth.html";
        const SCOPES = "user:read:email";

        const loggedInView = document.getElementById("logged-in-view");
        const loggedOutView = document.getElementById("logged-out-view");
        const welcomeMessage = document.getElementById("welcome-message");
        const loginLink = document.getElementById("login-link");
        const logoutButton = document.getElementById("logout");

        logoutButton.onclick = function() {
            localStorage.removeItem("twitch_token");
            window.location.reload();
        };

        (async function checkLoginState() {
            
            const token = localStorage.getItem("twitch_token");

            if (!token) {
                welcomeMessage.textContent = "Connectez-vous pour accéder à votre espace.";
                const authUrl = `https://id.twitch.tv/oauth2/authorize?client_id=${CLIENT_ID}&redirect_uri=${REDIRECT_URI}&response_type=token&scope=${SCOPES}`;
                loginLink.href = authUrl;
                loggedOutView.style.display = "block";
                
            } else {
                try {
                    const twitchHeaders = new Headers({
                        'Authorization': `Bearer ${token}`,
                        'Client-Id': CLIENT_ID
                    });
                    const response = await fetch('https://api.twitch.tv/helix/users', { headers: twitchHeaders });

                    if (!response.ok) {
                        throw new Error("Token expiré");
                    }
                    
                    const data = await response.json();
                    const user = data.data[0];
                    
                    welcomeMessage.textContent = `Bonjour, ${user.display_name} !`;
                    loggedInView.style.display = "block";

                } catch (error) {
                    console.error(error);
                    localStorage.removeItem("twitch_token");
                    checkLoginState();
                }
            }
        })();
    </script>
</body>
</html>